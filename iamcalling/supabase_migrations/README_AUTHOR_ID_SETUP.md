# Author ID Connection Setup

This document explains how to connect `articles.author_id` with `users.author_id` to enable listing all articles by an author on their profile.

## Problem
- Articles were being created without `author_id` set
- Profile page couldn't find articles because `author_id` was null
- No foreign key relationship existed between the tables

## Solution

### 1. Database Setup (Run in Supabase SQL Editor)

Run the migration file: `20240101000007_add_author_id_foreign_key.sql`

This will:
- Update existing articles to have valid `author_id` values where possible
- Add a foreign key constraint linking `articles.author_id` â†’ `users.author_id`
- Create an index for better query performance

**Important:** Before running the migration, ensure:
1. All users have `author_id` values (auto-generated by sequence)
2. The `users.author_id` column exists and has a default value

### 2. Code Changes (Already Implemented)

#### Article Creation (`22-write_article.html`)
- Now fetches user's `author_id` from `users` table before creating article
- Automatically sets `author_id` in article data

#### Article Creation (`supabase-client.js`)
- Updated `createArticle()` method to fetch and set `author_id`
- Works with both Supabase auth and globalAuth

#### Profile Page (`18-profile.html`)
- Already correctly queries articles by `author_id`
- Fetches user's `author_id` first, then queries articles

### 3. How It Works

1. **User Registration/Login:**
   - When a user is created, they automatically get an `author_id` (via sequence default)
   - This `author_id` is unique and stored in `users.author_id`

2. **Article Creation:**
   - When creating an article, the code fetches the user's `author_id` from `users` table
   - Sets `articles.author_id` to match `users.author_id`
   - Foreign key constraint ensures referential integrity

3. **Profile Display:**
   - Profile page fetches user's `author_id`
   - Queries all articles where `author_id` matches
   - Displays all articles by that author

### 4. Testing

After running the migration:

1. **Create a new article:**
   - Login and create an article
   - Check in Supabase that the article has `author_id` set
   - Verify it matches your `users.author_id`

2. **View profile:**
   - Go to your profile page
   - Your articles should now appear in "My Articles" section

3. **Verify relationship:**
   - In Supabase, check that `articles.author_id` values exist in `users.author_id`
   - Foreign key constraint will prevent invalid values

### 5. Troubleshooting

**If articles still don't show:**
1. Check that your user has an `author_id` in the `users` table
2. Verify articles have `author_id` set (not null)
3. Check browser console for any errors
4. Verify the foreign key constraint was created successfully

**If foreign key migration fails:**
- Some articles may have `author_id` values that don't exist in `users`
- Update those articles manually or set them to NULL
- Then re-run the migration

### 6. Future Articles

All new articles will automatically have `author_id` set because:
- Code fetches `author_id` before creating article
- Foreign key constraint ensures data integrity
- Both columns use the same `author_id` value from `users` table
