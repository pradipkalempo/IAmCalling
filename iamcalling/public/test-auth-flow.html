<!DOCTYPE html>
<html>
<head>
    <title>Auth Flow Test</title>
    <script src="js/universal-topbar-injector.js"></script>
</head>
<body>
    <div style="padding: 100px 20px; text-align: center;">
        <h1>Authentication Flow Test</h1>
        <div id="authStatus">Loading...</div>
        <div id="userInfo" style="margin: 20px 0;"></div>
        <button onclick="testAuth()">Test Auth State</button>
    </div>

    <script>
        function testAuth() {
            const status = document.getElementById('authStatus');
            const userInfo = document.getElementById('userInfo');
            
            if (window.globalAuth) {
                const isLoggedIn = window.globalAuth.isLoggedIn();
                const user = window.globalAuth.getCurrentUser();
                const userName = window.globalAuth.getUserName();
                
                status.innerHTML = `Auth Status: ${isLoggedIn ? 'LOGGED IN' : 'NOT LOGGED IN'}`;
                userInfo.innerHTML = `User: ${userName}<br>Data: ${JSON.stringify(user, null, 2)}`;
            } else {
                status.innerHTML = 'Global Auth Not Available';
                userInfo.innerHTML = 'Universal topbar not loaded';
            }
        }
        
        // Auto-test when ready
        function waitAndTest() {
            if (window.globalAuth && window.universalTopBar) {
                testAuth();
            } else {
                setTimeout(waitAndTest, 100);
            }
        }
        
        document.addEventListener('DOMContentLoaded', waitAndTest);
        window.addEventListener('authStateChanged', testAuth);
    </script>
</body>
</html>